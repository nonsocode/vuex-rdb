var VuexRdb=function(t,e){"use strict";function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=n(e),i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function o(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var a=function(){return(a=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function u(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}function s(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{s(r.next(t))}catch(t){o(t)}}function u(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((r=r.apply(t,e||[])).next())}))}function c(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}function l(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function f(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function h(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(f(arguments[e]));return t}var d=function(t){return t};function p(t){return t instanceof Function}function v(t){return!0===t||!1===t}function y(t){return"string"==typeof t}function m(t){var e=Object.create(null);return t?Object.assign(e,t):e}var _=function(t,e,n){void 0===n&&(n=void 0);var r=t.split(".").reduce((function(t,e){return null===t?void 0:t&&t[e]}),e||m());return void 0===r?n:r};function w(t,e){if(!e)return!1;for(;e;){if(e.item==t)return!0;e=e.parentNode}return!1}var g,b,x,A=function(){function t(t){void 0===t&&(t={}),this._default=p(t)?t():t.default}return Object.defineProperty(t.prototype,"default",{get:function(){return p(this._default)?this._default():this._default},enumerable:!1,configurable:!0}),t}(),O=function(t){function e(e){return void 0===e&&(e={}),t.call(this,e)||this}return o(e,t),e}(A);!function(t){t.ADD_ALL="ADD_ALL",t.PATCH_TEMPS="PATCH_TEMPS",t.SET_PROP="SET_PROP",t.SET_INDEX="SET_INDEX"}(g||(g={})),function(t){t.ADD="add",t.ADD_RELATED="addRelated",t.REMOVE_RELATED="removeRelated",t.UPDATE="update"}(b||(b={})),function(t){t.FIND="find",t.GET_RAW="getRaw",t.FIND_BY_IDS="findByIds",t.ALL="all",t.GET_INDEX="getIndex"}(x||(x={}));var E=function(t){function e(e){var n=t.call(this)||this;return n.context=e,n}return o(e,t),e.prototype.matchesItem=function(t){if(!this.whereAnds.length&&!this.whereOrs.length)return!0;var e=[],n=S(t);return e.push(!(!this.whereAnds.length||!this.whereAnds.every(n))),e.push(!(!this.whereOrs.length||!this.whereOrs.some(n))),e.some(d)},e.prototype.matchesSomeItems=function(t){var e=this;return t.every((function(t){return e.matchesItem(t)}))},e.prototype.matchesAllItems=function(t){var e=this;return t.some((function(t){return e.matchesItem(t)}))},e.prototype._filter=function(t){var e=this;return t.filter((function(t){return e.matchesItem(t)}))},e.prototype.get=function(){return this.matchesItem(this.context)},e}(function(){function t(){this.whereAnds=[],this.whereOrs=[]}return t.prototype.where=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.addWhere.apply(this,h(["and"],t)),this},t.prototype.orWhere=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.addWhere.apply(this,h(["or"],t)),this},t.prototype.addWhere=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r="and"==t?this.whereAnds:this.whereOrs;switch(e.length){case 1:if(!p(e[0])&&!v(e[0]))throw new Error("Argument should be a function or boolean");v(e[0])?r.push({operand:e[0]}):r.push({key:e[0]});break;case 2:r.push({key:e[0],value:e[1]});break;case 3:r.push({key:e[0],operand:e[1],value:e[2]});break;default:throw new Error("Illegal arguments supplied")}},t}()),D=function(t){function e(e,n){var r=t.call(this)||this;return r.factory=e,r.parentFactory=n,r}return o(e,t),Object.defineProperty(e.prototype,"schema",{get:function(){return this.factory()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentSchema",{get:function(){var t;return null===(t=this.parentFactory)||void 0===t?void 0:t.call(this)},enumerable:!1,configurable:!0}),e}(A),I=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e}(D),S=function(t){return function(e){if(p(e.key)){var n=new E(t),r=e.key.call(null,n,t);return"boolean"==typeof r?r:n.get()}if(y(e.key)&&p(e.value)){var i=_(e.key,t);return!!e.value.call(null,i)}if(v(e.operand))return e.operand;if(y(e.key)&&!p(e.value)){var o=_(e.key,t);switch(o=Array.isArray(o)&&"in"!=e.operand?o.length:o,e.operand){case"!=":return o!=e.value;case">":return o>e.value;case">=":return o>=e.value;case"<":return o<e.value;case"<=":return o<=e.value;case"in":return e.value.includes(o);case"=":default:return o==e.value}}}},j=function(t,e,n,r){if(n.has(t))r.push(n.getLoad(t));else{var i=new P(e);n.addLoad(t,i),r.push(i)}};function k(t,e){var n,r,i=[],o=function(t){var n=t.getRelationship().schema;if("*"===e)Object.entries(n._fields).filter((function(t){return f(t,2)[1]instanceof D})).forEach((function(e){var n=f(e,2),r=n[0],o=n[1];j(r,o,t,i)}));else if(n._fields[e]&&n._fields[e]instanceof D)j(e,n._fields[e],t,i);else{var r="["+e+"] is not a relationship on "+n.name;console.warn(r)}};try{for(var a=l(t),u=a.next();!u.done;u=a.next()){o(u.value)}}catch(t){n={error:t}}finally{try{u&&!u.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return i}var N=function(t){function e(e){var n=t.call(this)||this;return n.load=e,n.whereHasAnds=[],n.whereHasOrs=[],n.orders=[],n}return o(e,t),e.prototype.with=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];switch(t.length){case 1:case 2:this.load.parse(t[0],t[1]);break;default:throw new Error("Invalid arguments supplied")}return this},e.prototype.withoutRelationships=function(){return this.load&&this.load.clear(),this},e.prototype.get=function(){throw new Error("Method not allowed")},e.prototype.orderBy=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];switch(e.length){case 2:var r=f(e,2),i=r[0],o=r[1];this.orders.push({key:i,direction:o});break;case 1:(t=this.orders).push.apply(t,h(e));break;default:throw new Error("invalid OrderBy Arguments")}return this},e.prototype.apply=function(t){return Array.isArray(t)?this._sort(this._filter(t)):this.matchesItem(t)?t:void 0},e.prototype._sort=function(t){if(!this.orders.length||!t.length)return h(t);var e,n,r,i=(e=this.orders,n=e.length,r=e.map((function(t){return[t.key,"asc"==t.direction?1:-1]})),function(t,e){for(var i=0;i<n;i++){var o=f(r[i],2),a=o[0],u=o[1];if(t[a]<e[a])return-1*u;if(t[a]>e[a])return u}return 0});return h(t).sort(i)},e}(E),P=function(){function t(t){this.relationship=t,this.loads=new Map}return t.prototype.addLoad=function(t,e){this.loads.set(t,e)},t.prototype.getLoad=function(t){return this.loads.get(t)},t.prototype.clear=function(){this.loads.clear()},t.prototype.has=function(t){return this.loads.has(t)},t.prototype.apply=function(t){return this.query&&null!=t?this.query.apply(t):t},t.prototype.getRelationship=function(){return this.relationship},t.prototype.parse=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=this.parseRawLoadArgs.apply(this,h(e));return Object.entries(r).forEach((function(e){var n=f(e,2),r=n[0],i=n[1];r.split(".").reduce((function(t,e){return k(t,e)}),[t]).forEach((function(t){var e;p(i)&&(null!==(e=t.query)&&void 0!==e||(t.query=new N(t)),i.call(null,t.query))}))})),this},t.prototype.parseRawLoadArgs=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=m(),r=f(t,2),i=r[0],o=r[1];switch(t.length){case 1:Array.isArray(i)?i.forEach((function(t){return n[t]=!0})):y(i)?n[i]=!0:n=m(i);break;case 2:n[i]=o;break;default:throw new Error("Invalid arguments supplied")}return n},t}(),T=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e}(D),R=function(t){function e(e){var n=t.call(this,null)||this;return n.schema=e,n.withArgs=[],n}return o(e,t),e.prototype.with=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return this.load?t.prototype.with.call(this,e[0],e[1]):(this.withArgs.push(e),this)},e.prototype.withoutRelationships=function(){var e=this;return this.withArgs=[],this.load=new P(new T((function(){return e.schema}))),t.prototype.withoutRelationships.call(this)},e.prototype.initLoad=function(){var e=this;return!this.load&&this.withArgs.length&&(this.load=new P(new T((function(){return e.schema}))),this.withArgs.forEach((function(n){var r=f(n,2),i=r[0],o=r[1];t.prototype.with.call(e,i,o)}))),this.load},e.prototype.get=function(){var t=this,e=this.schema.all();return e=this.apply(e),this.initLoad()?e.map((function(e){return t.schema.find(z(e,t.schema),{load:t.load})})):e},e.prototype.first=function(){var t=this,e=this.schema.all().find((function(e){return t.matchesItem(e)}));if(e)return this.initLoad()?this.schema.find(z(e,this.schema),{load:this.load}):e},e}(N),L=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.foreignKey=r,i}return o(e,t),e}(D);function F(t,e){return function(n,r){var i=n.constructor;null==i._fields&&(i._fields=m()),r in i._fields||(i._fields[r]=F.define(t,(function(){return i}),e))}}F.define=function(t,e,n){return new L(t,e,n)};var M=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.foreignKey=r,i}return o(e,t),e}(I);function B(t,e){return function(n,r){var i=n.constructor;null==i._fields&&(i._fields=m()),r in i._fields||(i._fields[r]=B.define(t,(function(){return i}),e))}}B.define=function(t,e,n){return new M(t,e,n)};var C=function(){function t(t,e){var n,i;this._connected=!1;var o=t?z(t,q(this)):null;Object.defineProperties(this,{_caches:{value:Object.fromEntries(H.map((function(t){return[t,{}]})))},_connected:{value:!!(null==e?void 0:e.connected),enumerable:!1,configurable:!0},_load:{value:null==e?void 0:e.load,enumerable:!1,configurable:!0},_id:{value:o,enumerable:!1,configurable:!1,writable:!0}});var a=q(this)._fields;try{for(var u=l(Object.keys(a)),s=u.next();!s.done;s=u.next()){U(this,s.value)}}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}this._connected||(!function(t,e){void 0===e&&(e={});Object.entries(q(t)._fields).forEach((function(n){var r,i=f(n,2),o=i[0],a=i[1];t._caches[J(a instanceof D)][o]=null!==(r=e[o])&&void 0!==r?r:a.default}))}(this,t||{}),r.default.observable(this._caches))}return t.prototype.toJSON=function(t,e){var n,r,i,o,a=q(this),u={};try{for(var s=l(Object.entries(this)),c=s.next();!c.done;c=s.next()){var h=f(c.value,2),d=h[0],p=h[1];if(d in a._fields)if(a._fields[d]instanceof D){var v={item:this,parentNode:e};if(null==p)u[d]=p;else if(Array.isArray(p)){var y=[];try{for(var m=(i=void 0,l(p)),_=m.next();!_.done;_=m.next()){var g=_.value;y.push(g.toJSON?w(g,v)?Z(g):g.toJSON(d,v):g)}}catch(t){i={error:t}}finally{try{_&&!_.done&&(o=m.return)&&o.call(m)}finally{if(i)throw i.error}}u[d]=y}else u[d]=p.toJSON?w(p,v)?Z(p):p.toJSON(d,v):p}else u[d]=p}}catch(t){n={error:t}}finally{try{c&&!c.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return u},t.prototype.$toObject=function(t){return void 0===t&&(t=!1),function t(e,n,r,i){void 0===i&&(i=new Map);var o={};return i.set(e,o),Object.entries(e).reduce((function(e,o){var a,u,s=f(o,2),c=s[0],h=s[1];if(c in n._fields){var d=n._fields[c];if(d instanceof D){var p=d.schema;if(null==h)e[c]=null;else if(Array.isArray(h)&&d instanceof I){var v=[];try{for(var y=l(h),m=y.next();!m.done;m=y.next()){var _=m.value;v.push(i.has(_)?i.get(_):t(_,p,r,i))}}catch(t){a={error:t}}finally{try{m&&!m.done&&(u=y.return)&&u.call(y)}finally{if(a)throw a.error}}e[c]=v}else e[c]=i.has(h)?i.get(h):t(h,p,r,i)}else e[c]=h}return e}),o),o}(this,q(this),t)},t.prototype.$update=function(t){return void 0===t&&(t={}),s(this,void 0,void 0,(function(){var e,n=this;return c(this,(function(r){return[2,(e=q(this))._store.dispatch(e._namespace+"/update",{id:this._id,data:t,schema:e}).then((function(t){return n._connected=!0,t}))]}))}))},t.prototype.$save=function(){return s(this,void 0,void 0,(function(){var t=this;return c(this,(function(e){return[2,new Promise((function(e){var n=q(t);if(t._connected)console.warn("No need calling $save. This entity is already connected to the Vuex store");else{var r=H.reduce((function(e,n){return a(a({},e),t._caches[n])}),{});e(n._store.dispatch(n._namespace+"/"+b.ADD,{items:r,schema:n}).then((function(e){return t._id=e,t._connected=!0,e})))}}))]}))}))},Object.defineProperty(t,"fields",{get:function(){return{}},enumerable:!1,configurable:!0}),t.find=function(t,e){return void 0===e&&(e={}),this._store.getters[this._namespace+"/"+x.FIND](t,this,e)},t.findByIds=function(t,e){return void 0===e&&(e={}),this._store.getters[this._namespace+"/"+x.FIND_BY_IDS](t,this,e)},t.all=function(t){return void 0===t&&(t={}),this._store.getters[this._namespace+"/"+x.ALL](this,t)},t.add=function(t){return this._store.dispatch(this._namespace+"/"+b.ADD,{items:t,schema:this})},t.addAll=function(t){return this._store.dispatch(this._namespace+"/"+b.ADD,{items:t,schema:[this]})},t.$item=function(t){var e=this;return rt.define(t,(function(){return e}))},t.$list=function(t){var e=this;return it.define(t,(function(){return e}))},t.$field=function(t){return void 0===t&&(t={}),nt.define(t)},t.$belongsTo=function(t,e){var n=this;return F.define(t,(function(){return n}),e)},t.$hasMany=function(t,e){var n=this;return B.define(t,(function(){return n}),e)},t.query=function(t){var e=new R(this);return t&&t(e),e},t.id="id",t}(),W=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e}(I);function $(t,e,n,r,i){var o,a,u,s,c,h,d,p,v,y;void 0===n&&(n=new Map),void 0===r&&(r=new Map),void 0===i&&(i=0);var _,w=function(t){return Array.isArray(t)?t[0]:t.prototype instanceof C?t:t instanceof D?t.schema:null}(e),g=w._fields;if(null==t)_=null;else if(Array.isArray(t)&&function(t){return Array.isArray(t)||t instanceof I}(e))_=t.map((function(t){return $(t,w,n,r,i+1).result})).filter((function(t){return null!=t}));else if(n.has(t))_=n.get(t);else{_=z(t,w),n.set(t,_),r.has(w)||r.set(w,m()),r.get(w)[_]||(r.get(w)[_]={});var b=r.get(w)[_],x=[],A=[],O=[];try{for(var E=l(Object.entries(t)),S=E.next();!S.done;S=E.next()){var j=f(S.value,2),k=j[0],N=j[1];k in g&&(g[k]instanceof D?x:A).push([k,N])}}catch(t){o={error:t}}finally{try{S&&!S.done&&(a=E.return)&&a.call(E)}finally{if(o)throw o.error}}try{for(var P=l(x),R=P.next();!R.done;R=P.next()){var F=f(R.value,2),B=(k=F[0],$(N=F[1],J=g[k],n,r,i+1).result);O.push({key:k,value:B,relationship:J})}}catch(t){u={error:t}}finally{try{R&&!R.done&&(s=P.return)&&s.call(P)}finally{if(u)throw u.error}}try{for(var G=l(A),K=G.next();!K.done;K=G.next()){var X=f(K.value,2);k=X[0],N=X[1];b[k]=N}}catch(t){c={error:t}}finally{try{K&&!K.done&&(h=G.return)&&h.call(G)}finally{if(c)throw c.error}}try{for(var q=l(O),H=q.next();!H.done;H=q.next()){var J,Y=H.value;k=Y.key,N=Y.value;switch(!0){case(J=Y.relationship)instanceof T:case J instanceof W:b[k]=N;break;case J instanceof M:if(null==N)continue;var V=J,U=V.schema,Q=V.foreignKey;try{for(var Z=(v=void 0,l(N)),tt=Z.next();!tt.done;tt=Z.next()){var et=tt.value;r.get(U)[et][Q]=_}}catch(t){v={error:t}}finally{try{tt&&!tt.done&&(y=Z.return)&&y.call(Z)}finally{if(v)throw v.error}}break;case J instanceof L:b[Q=J.foreignKey]=N}}}catch(t){d={error:t}}finally{try{H&&!H.done&&(p=q.return)&&p.call(q)}finally{if(d)throw d.error}}}return{result:_,entities:r}}function G(t,e){var n,r;try{for(var i=l(t),o=i.next();!o.done;o=i.next()){if(null==z(o.value,e))throw new Error("An item being assigned to this array does not have a valid identifier")}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}function K(){return function(t,e,n){var r=n.value;n.value=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._schema;G(t,n),r.apply(this,t)}}}var X=function(t){function e(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=t.apply(this,h(n))||this;return Object.setPrototypeOf(i,e.prototype),i}return o(e,t),e.prototype._init=function(e,n,r){return Object.defineProperties(this,{_context:{value:e},_key:{value:n},_store:{value:q(e)._store},_contextSchema:{value:q(e)},_schema:{value:q(e)._fields[n].schema}}),t.prototype.push.apply(this,r),this},e.prototype.push=function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return Q(this._store,a(a({},this._context),((e={})[this._key]=h(this._allForContext(),n),e)),this._contextSchema),t.prototype.splice.apply(this,h([0,this.length],this._context[this._key])),this.length},e.prototype.pop=function(){var e=t.prototype.pop.call(this);return this._remove([e]),e},e.prototype.unshift=function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return Q(this._store,a(a({},this._context),((e={})[this._key]=h(this._allForContext(),n),e)),this._contextSchema),t.prototype.splice.apply(this,h([0,this.length],this._context[this._key])),this.length},e.prototype.shift=function(){var e=t.prototype.shift.call(this);return this._remove([e]),e},e.prototype.splice=function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=f(n),o=i[0],u=i[1],s=i.slice(2),c=0===n.length?[]:t.prototype.splice.apply(this,h([o,u],s));return this._remove(c),Q(this._store,a(a({},this._context),((e={})[this._key]=h(this._allForContext(),s),e)),this._contextSchema),c},e.prototype.toPlainArray=function(){return h(this).map((function(t){return t instanceof C?t.$toObject():t}))},e.prototype._remove=function(t){if(t.length){var e=this._schema,n=this._key,r=this._contextSchema._fields[n],i=this._allForContext(),o=t.map((function(t){return z(t,e)}));switch(!0){case r instanceof W:var a=i.map((function(t){return z(t,e)})).filter((function(t){return!o.includes(t)}));this._mutateContext(a);break;case r instanceof M:e.findByIds(o).forEach((function(t){return t[r.foreignKey]=null}))}}},e.prototype._allForContext=function(){var t;return(null===(t=this._contextSchema.find(this._context._id))||void 0===t?void 0:t[this._key])||[]},e.prototype._mutateContext=function(t){this._store.commit(this._contextSchema._namespace+"/"+g.SET_PROP,{id:this._context._id,key:this._key,value:t,schema:this._contextSchema})},u([K()],e.prototype,"push",null),u([K()],e.prototype,"unshift",null),u([function(t,e,n){var r=n.value;n.value=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._schema,i=f(t),o=i.slice(2);o.length&&G(o,n),r.apply(this,t)}}],e.prototype,"splice",null),e}(Array);function q(t){return t.constructor}window.ModelArray=X;var H=["data","relationship"],J=function(t){return H[t?1:0]},Y=function(t,e){return["string","number"].includes(typeof t)?e.find(t):t};function V(t,e,n,r,i){var o,u,s=i._store,c=i._namespace,l=i.id;if(r){var f=r.schema;if(n=Y(n,f),r instanceof I&&null!=n&&(n=Array.isArray(n)?n:[n].filter(d)),null!=n&&!function(t,e){var n=e.schema;return e instanceof I?t.every((function(t){return null!=z(t,n)})):null!=z(t,n)}(n,r))throw new Error("An item being assigned to the property ["+e+"] does not have a valid identifier");Q(s,a(a({},t),((o={})[e]=n,o)),i)}else{if(p(l)||l==e)if(z(t,i)!=z(a(a({},t),((u={})[e]=n,u)),i))throw new Error("This update is not allowed because the resolved id is different from the original value");s.commit(c+"/"+g.SET_PROP,{id:t._id,key:e,value:n,schema:i})}}function U(t,e){var n=q(t),i=n._namespace,o=n._store,a=n._fields,u=a[e]instanceof D,s=u?a[e]:null,c=t._load;Object.defineProperty(t,e,{enumerable:!c||!u||c.has(e),get:function(){if(t._connected){if(c&&u&&!c.has(e))return;var r=o.getters[i+"/"+x.GET_RAW](t._id,n),a=r[e];if(u){var l={load:null==c?void 0:c.getLoad(e)},f=s.schema;if(s instanceof I)return s instanceof M&&(a=n.index.get(s,this._id)),a?(a=f.findByIds(a,l),l.load&&(a=l.load.apply(a)),a&&(new X)._init(t,e,a)):void 0;if(s instanceof L){if(!(null==r?void 0:r[s.foreignKey]))return;a=r[s.foreignKey]}return a=f.find(a,l),l.load?l.load.apply(a):a}return r[e]}return t._caches[J(u)][e]},set:function(i){t._connected?V(t,e,i,s,n):function(t,e,n,i){if(i){var o=i.schema;n=Y(n,o),i instanceof I&&null!=n&&(n=Array.isArray(n)?n:[n].filter(d))}r.default.set(t._caches[J(!!i)],e,n)}(t,e,i,s)}})}function z(t,e){return p(e.id)?e.id(t,null,null):t[e.id]}function Q(t,e,n){var r,i,o=$(e,n),a=o.entities,u=o.result;try{for(var s=l(a.entries()),c=s.next();!c.done;c=s.next()){var h=f(c.value,2),d=h[0],p=h[1];t.commit(d._namespace+"/"+g.ADD_ALL,{schema:d,items:p},{root:!0})}}catch(t){r={error:t}}finally{try{c&&!c.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return u}function Z(t){var e=">>> Recursive item ";return t instanceof C&&(e+="["+t.constructor.name+": "+t._id+"] "),e+"<<<"}function tt(t,e,n){var i,o,u;return{namespaced:!0,state:function(){return{indices:n.toObject(),data:h(new Set(e.map((function(t){return t.entityName})))).reduce((function(t,e){return t[e]={},t}),{})}},mutations:(i={},i[g.ADD_ALL]=function(t,e){var n=e.items,r=e.schema.entityName;t.data[r]=a(a({},t.data[r]),Object.fromEntries(Object.entries(n).map((function(e){var n=f(e,2),i=n[0],o=n[1];return[i,a(a({},t.data[r][i]),o)]}))))},i[g.SET_PROP]=function(t,e){var n=e.id,i=e.key,o=e.value,a=e.schema;if(null==t.data[a.entityName][n])throw new Error("Entity does not exist");r.default.set(t.data[a.entityName][n],i,o)},i[g.SET_INDEX]=function(t,e){var n=e.indexName,i=e.data;r.default.set(t.indices,n,i)},i),actions:(o={},o[b.ADD]=function(e,n){var r=n.items,i=n.schema;return Q(t,r,i)},o[b.UPDATE]=function(t,e){var n=t.getters,r=t.dispatch,i=e.id,o=e.data,u=e.schema;if(null==i)throw new Error("Id to perform update must be defined");var s,c=Array.isArray(i)?i:[i],l=n[x.FIND_BY_IDS](c,u).filter(d);if(l.length!==c.length)throw new Error("Invalid item to update");if(p(u.id)){s=l.map((function(t){return a(a({},t),o)}));var f=l.map((function(t){return z(t,u)})),h=s.map((function(t){return z(t,u)}));if(f.some((function(t,e){return t!=h[e]})))throw new Error("Invalid Update: This would cause a change in the computed id.")}else{var v=u.id;s=l.map((function(t){var e;return a(a(a({},p(u.id)?t:null),o),((e={})[v]=i,e))}))}return r(b.ADD,{items:s,schema:[u]})},o),getters:(u={},u[x.GET_RAW]=function(t){return function(e,n){return t.data[n.entityName][e]}},u[x.GET_INDEX]=function(t){return function(e,n,r){var i;return(null===(i=t.indices[e.entityName][n])||void 0===i?void 0:i[r])||[]}},u[x.FIND]=function(t,e){return function(t,n,r){void 0===r&&(r={});var i,o=e[x.GET_RAW](t,n);if(o)return r.load&&(i=r.load instanceof P?r.load:new P(new T((function(){return n}))).parse(r.load)),function(t,e,n){var r;void 0===n&&(n={});var i=z(e,t);if(n.load)return new t(e,n);et.has(t)||et.set(t,m());var o=et.get(t);return null!==(r=o[i])&&void 0!==r?r:o[i]=new t(e,n)}(n,o,{load:i,connected:!0})}},u[x.FIND_BY_IDS]=function(t,e){return function(t,n,r){return void 0===t&&(t=[]),void 0===r&&(r={}),t.map((function(t){return e[x.FIND](t,n,r)})).filter(d)}},u[x.ALL]=function(t,e){return function(n,r){return void 0===r&&(r={}),e[x.FIND_BY_IDS](Object.keys(t.data[n.entityName]),n,r)}},u)}}var et=new Map;function nt(t){return void 0===t&&(t={}),function(e,n){var r=e.constructor;null==r._fields&&(r._fields=m()),n in r._fields||(r._fields[n]=nt.define(t))}}function rt(t){return function(e,n){var r=e.constructor;null==r._fields&&(r._fields=m()),n in r._fields||(r._fields[n]=rt.define(t,(function(){return r})))}}function it(t){return function(e,n,r){var i=e.constructor;null==i._fields&&(i._fields=m()),n in i._fields||(i._fields[n]=it.define(t,(function(){return i})))}}window.modelCache=et,nt.define=function(t){return void 0===t&&(t={}),new O(t)},rt.define=function(t,e){return new T(t,e)},it.define=function(t,e){return new W(t)};var ot=function(){function t(t,e,n,r){this.schema=t,this.store=e,this.namespace=n,this.name=r,this.interests=new Set}return t.prototype.addRelationship=function(t){if(t.schema!=this.schema)throw new Error("This relationship is not indexable on this watcher");this.interests.add(t)},t.prototype.registerWatcher=function(){var t=this;this.unwatch&&this.unwatch();var e=h(this.interests.values()).map((function(t){return[t.parentSchema.entityName,t.foreignKey]}));this.unwatch=this.store.watch((function(n){var r,i,o,a,u=e.reduce((function(t,e){return t[f(e,1)[0]]=m(),t}),m()),s=Object.entries(n[t.namespace].data[t.schema.entityName]);try{for(var c=l(s),h=c.next();!h.done;h=c.next()){var d=f(h.value,2),p=d[0],v=d[1];try{for(var y=(o=void 0,l(e)),_=y.next();!_.done;_=y.next()){var w=f(_.value,2),g=w[0],b=w[1];null!=v[b]&&(u[g][v[b]]||(u[g][v[b]]=[]),u[g][v[b]].push(p))}}catch(t){o={error:t}}finally{try{_&&!_.done&&(a=y.return)&&a.call(y)}finally{if(o)throw o.error}}}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}return u}),(function(e){return t.store.commit(t.namespace+"/"+g.SET_INDEX,{indexName:t.name,data:e})}))},t}(),at=function(){function t(t,e){this.store=t,this.namespace=e,this.map=new Map}return t.prototype.addIndex=function(t){var e,n=t.schema;this.map.has(n)?e=this.map.get(n):(e=new ot(n,this.store,this.namespace,n.entityName),this.map.set(n,e)),e.addRelationship(t)},t.prototype.toObject=function(){var t,e,n,r,i=m();try{for(var o=l(this.map),a=o.next();!a.done;a=o.next()){var u=f(a.value,2),s=u[0],c=u[1];i[s.entityName]=m();try{for(var h=(n=void 0,l(c.interests)),d=h.next();!d.done;d=h.next()){var p=d.value;i[s.entityName][p.parentSchema.entityName]=m()}}catch(t){n={error:t}}finally{try{d&&!d.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}return i},t.prototype.init=function(){var t,e;try{for(var n=l(this.map.values()),r=n.next();!r.done;r=n.next()){r.value.registerWatcher()}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},t.prototype.get=function(t,e){var n=t.schema,r=t.parentSchema;return this.store.getters[this.namespace+"/"+x.GET_INDEX](n,r.entityName,e)},t}(),ut={schemas:[],namespace:"database"};return t.BelongsTo=F,t.Field=nt,t.HasMany=B,t.Item=rt,t.List=it,t.Model=C,t.generateDatabasePlugin=function(t){var e=a(a({},ut),t),n=e.schemas,r=e.namespace;return function(t){var e=new at(t,r);Object.defineProperty(C,"index",{value:e}),n.forEach((function(n){!function(t,e,n){t._fields||Object.defineProperty(t,"_fields",{value:m({})}),"string"!=typeof t.id||t.id in t._fields||(t._fields[t.id]=new O),t.fields&&Object.assign(t._fields,t.fields),Object.defineProperties(t,{_namespace:{value:n},_store:{value:e}}),Object.freeze(t)}(n,t,r),Object.values(n._fields).forEach((function(t){t instanceof M&&e.addIndex(t)}))})),t.registerModule(r,tt(t,n,e)),e.init()}},t}({},Vue);
